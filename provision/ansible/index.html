<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.57.0" />
    <meta name="description" content="Workday">
<meta name="author" content="Iris Garcia">

    <link rel="shortcut icon" href="https://iris-garcia.github.io/workday//images/favicon.png" type="image/x-icon" />

    <title>Ansible :: Workday</title>

    
    <link href="../../css/nucleus.css?1575912935" rel="stylesheet">
    <link href="../../css/fontawesome-all.min.css?1575912935" rel="stylesheet">
    <link href="../../css/hybrid.css?1575912935" rel="stylesheet">
    <link href="../../css/featherlight.min.css?1575912935" rel="stylesheet">
    <link href="../../css/perfect-scrollbar.min.css?1575912935" rel="stylesheet">
    <link href="../../css/auto-complete.css?1575912935" rel="stylesheet">
    <link href="../../css/atom-one-dark-reasonable.css?1575912935" rel="stylesheet">
    <link href="../../css/theme.css?1575912935" rel="stylesheet">
    <link href="../../css/hugo-theme.css?1575912935" rel="stylesheet">
    
      <link href="../../css/theme-blue.css?1575912935" rel="stylesheet">
    

    <script src="../../js/jquery-3.3.1.min.js?1575912935"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<link rel="stylesheet" type="text/css" href="https://iris-garcia.github.io/workday//css/asciinema-player.css" />


<link rel="stylesheet" type="text/css" href="https://iris-garcia.github.io/workday//css/custom.css" />

  </head>
  <body class="" data-url="/provision/ansible/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a href="https://iris-garcia.github.io/workday/"><img src="https://iris-garcia.github.io/workday//images/logo.png"/></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../../js/lunr.min.js?1575912935"></script>
<script type="text/javascript" src="../../js/auto-complete.js?1575912935"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/iris-garcia.github.io\/workday\/";
    
</script>
<script type="text/javascript" src="../../js/search.js?1575912935"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/description/" title="Description" class="dd-item 
        
        
        
        ">
      <a href="../../description/">
          <b>1. </b>Description
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/description/what/" title="What is Workday?" class="dd-item ">
        <a href="../../description/what/">
        What is Workday?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/description/why/" title="Why?" class="dd-item ">
        <a href="../../description/why/">
        Why?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/dev/" title="Development" class="dd-item 
        
        
        
        ">
      <a href="../../dev/">
          <b>2. </b>Development
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/dev/tools/" title="Toolchain" class="dd-item ">
        <a href="../../dev/tools/">
        Toolchain
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dev/requirements/" title="Requirements" class="dd-item ">
        <a href="../../dev/requirements/">
        Requirements
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/dev/api/" title="API Test Class" class="dd-item ">
        <a href="../../dev/api/">
        API Test Class
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/ci/" title="Continuous Integration" class="dd-item 
        
        
        
        ">
      <a href="../../ci/">
          <b>3. </b>Continuous Integration
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/ci/travis/" title="Travis CI" class="dd-item ">
        <a href="../../ci/travis/">
        Travis CI
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/ci/github/" title="GitHub Actions" class="dd-item ">
        <a href="../../ci/github/">
        GitHub Actions
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docker/" title="Docker" class="dd-item 
        
        
        
        ">
      <a href="../../docker/">
          <b>4. </b>Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/docker/dockerfile/" title="Dockerfile" class="dd-item ">
        <a href="../../docker/dockerfile/">
        Dockerfile
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docker/build/" title="Building the Docker image" class="dd-item ">
        <a href="../../docker/build/">
        Building the Docker image
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docker/dockerhub/" title="Docker Hub" class="dd-item ">
        <a href="../../docker/dockerhub/">
        Docker Hub
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/deployment/" title="Deployment" class="dd-item 
        
        
        
        ">
      <a href="../../deployment/">
          <b>4. </b>Deployment
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/deployment/openshit/" title="OpenShift" class="dd-item ">
        <a href="../../deployment/openshit/">
        OpenShift
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/provision/" title="Provision" class="dd-item 
        parent
        
        
        ">
      <a href="../../provision/">
          <b>4. </b>Provision
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/provision/os/" title="Operating System" class="dd-item ">
        <a href="../../provision/os/">
        Operating System
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/provision/ansible/" title="Ansible" class="dd-item active">
        <a href="../../provision/ansible/">
        Ansible
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/provision/vm/" title="Creation of VM" class="dd-item ">
        <a href="../../provision/vm/">
        Creation of VM
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/provision/task-manager/" title="Task manager configuration" class="dd-item ">
        <a href="../../provision/task-manager/">
        Task manager configuration
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/howto/" title="How-to" class="dd-item 
        
        
        
        ">
      <a href="../../howto/">
          <b>5. </b>How-to
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/howto/gh-pages/" title="GitHub Pages" class="dd-item 
        
        
        
        ">
      <a href="../../howto/gh-pages/">
          GitHub Pages
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/howto/travis-cd/" title="Continuous Delivery (Travis CI)" class="dd-item 
        
        
        
        ">
      <a href="../../howto/travis-cd/">
          Continuous Delivery (Travis CI)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/howto/github-cd/" title="Continuous Delivery (GitHub)" class="dd-item 
        
        
        
        ">
      <a href="../../howto/github-cd/">
          Continuous Delivery (GitHub)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/iris-garcia/workday"><i class='fab fa-github' style='margin-right:10px;'></i>Workday</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/iris-garcia/workday/tags"><i class='fas fa-tags'></i> Tags</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Ansible 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#structure">Structure</a></li>
<li><a href="#playbook">Playbook</a></li>
<li><a href="#roles">Roles</a></li>
<li><a href="#inventory">Inventory</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Ansible
            </h1>
          

        





<h2 id="structure">Structure</h2>

<figure>
    <img src="../../images/ansible.png"
         alt="Figure 1: directory structure"/> <figcaption>
            <p>Figure 1: directory structure</p>
        </figcaption>
</figure>


<h2 id="playbook">Playbook</h2>

<p>The following playbook has been created:</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Base<span style="color:#666"> </span>setup<span style="color:#666">
</span><span style="color:#666">  </span>hosts:<span style="color:#666"> </span>api<span style="color:#666">
</span><span style="color:#666">  </span>gather_facts:<span style="color:#666"> </span>no<span style="color:#666">
</span><span style="color:#666">  </span>become:<span style="color:#666"> </span>yes<span style="color:#666">
</span><span style="color:#666">  </span>tags:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>base<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>vars:<span style="color:#666">
</span><span style="color:#666">    </span>USER:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;workday&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>PACKAGES:<span style="color:#666">
</span><span style="color:#666">      </span>-<span style="color:#666"> </span>git<span style="color:#666">
</span><span style="color:#666">      </span>-<span style="color:#666"> </span>wget<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>pre_tasks:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Install<span style="color:#666"> </span>system<span style="color:#666"> </span>packages<span style="color:#666">
</span><span style="color:#666">      </span>apt:<span style="color:#666">
</span><span style="color:#666">        </span>name:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;{{ PACKAGES }}&#34;</span><span style="color:#666">
</span><span style="color:#666">        </span>update_cache:<span style="color:#666"> </span>yes<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>roles:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>role:<span style="color:#666"> </span>user<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Setup<span style="color:#666"> </span>Golang<span style="color:#666">
</span><span style="color:#666">  </span>hosts:<span style="color:#666"> </span>api<span style="color:#666">
</span><span style="color:#666">  </span>gather_facts:<span style="color:#666"> </span>no<span style="color:#666">
</span><span style="color:#666">  </span>become:<span style="color:#666"> </span>yes<span style="color:#666">
</span><span style="color:#666">  </span>tags:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>go<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>vars:<span style="color:#666">
</span><span style="color:#666">    </span>GO_VERSION:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;1.13.3&#34;</span><span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>roles:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>role:<span style="color:#666"> </span>go<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Setup<span style="color:#666"> </span>build<span style="color:#666"> </span>tool<span style="color:#666"> </span>Mage<span style="color:#666">
</span><span style="color:#666">  </span>hosts:<span style="color:#666"> </span>api<span style="color:#666">
</span><span style="color:#666">  </span>gather_facts:<span style="color:#666"> </span>no<span style="color:#666">
</span><span style="color:#666">  </span>become:<span style="color:#666"> </span>yes<span style="color:#666">
</span><span style="color:#666">  </span>tags:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>buildtool<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>vars:<span style="color:#666">
</span><span style="color:#666">    </span>USER:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;workday&#34;</span><span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>roles:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>role:<span style="color:#666"> </span>mage<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Setup<span style="color:#666"> </span>process<span style="color:#666"> </span>manager<span style="color:#666"> </span>pm2<span style="color:#666">
</span><span style="color:#666">  </span>hosts:<span style="color:#666"> </span>api<span style="color:#666">
</span><span style="color:#666">  </span>gather_facts:<span style="color:#666"> </span>no<span style="color:#666">
</span><span style="color:#666">  </span>become:<span style="color:#666"> </span>yes<span style="color:#666">
</span><span style="color:#666">  </span>tags:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>pm2<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666">  </span>roles:<span style="color:#666">
</span><span style="color:#666">    </span>-<span style="color:#666"> </span>role:<span style="color:#666"> </span>pm2</code></pre></div>
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 1</span>:
  .packer/ansible/workday.yml
</div>

<p>It has four main tasks, each of them run a role and has a <code>tag</code>
defined to allow running a one or more tasks instead of the whole
playbook.</p>


<div class="notices tip" ><p><strong>The use of <code>become: yes</code> is needed because the playbook is ran using
the <code>vagrant</code> user, therefore privileged rights are needed.</strong></p>
</div>


<h2 id="roles">Roles</h2>

<ol>
<li><p><code>Base setup</code>: This role installs some base packages needed and
creates an APP user (<strong>workday</strong>) using a variable, this allows to
easily change the user name without having to change the role.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">​-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Create<span style="color:#666"> </span>App<span style="color:#666"> </span>user<span style="color:#666">
</span><span style="color:#666">  </span>user:<span style="color:#666">
</span><span style="color:#666">    </span>name:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;{{ USER }}&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>shell:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/bin/bash&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>create_home:<span style="color:#666"> </span>True</code></pre></div>
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 2</span>:
  .packer/ansible/roles/user/tasks/main.yml
</div></li>

<li><p><code>Setup Golang</code>: This role downloads and installs a specific Go
version given as a variable, it also creates a symlink of the Go
binary to <strong>/usr/local/bin/go</strong>.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">​-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Check<span style="color:#666"> </span>if<span style="color:#666"> </span>go<span style="color:#666"> </span>is<span style="color:#666"> </span>already<span style="color:#666"> </span>installed<span style="color:#666">
</span><span style="color:#666">  </span>stat:<span style="color:#666">
</span><span style="color:#666">    </span>path:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/usr/local/bin/go&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>register:<span style="color:#666"> </span>go_binary<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Download<span style="color:#666"> </span>Go<span style="color:#666"> </span>archive<span style="color:#666">
</span><span style="color:#666">  </span>get_url:<span style="color:#666">
</span><span style="color:#666">    </span>url:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;https://dl.google.com/go/go{{ GO_VERSION }}.linux-amd64.tar.gz&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>dest:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/tmp/go{{ GO_VERSION }}.linux-amd.tar.gz&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>when:<span style="color:#666"> </span>not<span style="color:#666"> </span>go_binary.stat.exists<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Unarchive<span style="color:#666"> </span>Go<span style="color:#666"> </span>archive<span style="color:#666">
</span><span style="color:#666">  </span>unarchive:<span style="color:#666">
</span><span style="color:#666">    </span>src:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/tmp/go{{ GO_VERSION }}.linux-amd.tar.gz&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>dest:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/usr/local&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>remote_src:<span style="color:#666"> </span>yes<span style="color:#666">
</span><span style="color:#666">  </span>when:<span style="color:#666"> </span>not<span style="color:#666"> </span>go_binary.stat.exists<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Symlink<span style="color:#666"> </span>Go<span style="color:#666"> </span>binary<span style="color:#666">
</span><span style="color:#666">  </span>file:<span style="color:#666">
</span><span style="color:#666">    </span>src:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/usr/local/go/bin/go&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>dest:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/usr/local/bin/go&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>state:<span style="color:#666"> </span>link<span style="color:#666">
</span><span style="color:#666">  </span>when:<span style="color:#666"> </span>not<span style="color:#666"> </span>go_binary.stat.exists</code></pre></div>
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 3</span>:
  .packer/ansible/roles/go/tasks/main.yml
</div></li>

<li><p><code>Setup Mage</code>: This is the build tool used in this project, this
role installs Mage in the <em>GOROOT</em> path of the user given as a
variable.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">​-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Create<span style="color:#666"> </span>GOROOT<span style="color:#666"> </span>for<span style="color:#666"> </span>user<span style="color:#666">
</span><span style="color:#666">  </span>file:<span style="color:#666">
</span><span style="color:#666">    </span>path:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/home/{{ USER }}/go/src&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>state:<span style="color:#666"> </span>directory<span style="color:#666">
</span><span style="color:#666">    </span>owner:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;{{ USER }}&#34;</span><span style="color:#666">
</span><span style="color:#666">    </span>group:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;{{ USER }}&#34;</span><span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Check<span style="color:#666"> </span>if<span style="color:#666"> </span>mage<span style="color:#666"> </span>is<span style="color:#666"> </span>installed<span style="color:#666">
</span><span style="color:#666">  </span>stat:<span style="color:#666">
</span><span style="color:#666">    </span>path:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/home/{{ USER }}/go/bin/mage&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>register:<span style="color:#666"> </span>mage<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Install<span style="color:#666"> </span>mage<span style="color:#666">
</span><span style="color:#666">  </span>environment:<span style="color:#666">
</span><span style="color:#666">    </span>GOROOT:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/home/{{ USER }}/go&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>shell:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;sudo -u {{ USER }} go get github.com/magefile/mage&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>when:<span style="color:#666"> </span>not<span style="color:#666"> </span>mage.stat.exists</code></pre></div>
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 4</span>:
  .packer/ansible/roles/mage/tasks/main.yml
</div></li>

<li><p><code>Setup Process Manager</code>: A role to install npm and pm2, which will
be used once we deploy the project.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">​-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Install<span style="color:#666"> </span>npm<span style="color:#666">
</span><span style="color:#666">  </span>apt:<span style="color:#666">
</span><span style="color:#666">    </span>name:<span style="color:#666"> </span>npm<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Check<span style="color:#666"> </span>if<span style="color:#666"> </span>pm2<span style="color:#666"> </span>is<span style="color:#666"> </span>installed<span style="color:#666">
</span><span style="color:#666">  </span>stat:<span style="color:#666">
</span><span style="color:#666">    </span>path:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;/usr/local/bin/pm2&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>register:<span style="color:#666"> </span>pm2<span style="color:#666">
</span><span style="color:#666">
</span><span style="color:#666"></span>-<span style="color:#666"> </span>name:<span style="color:#666"> </span>Install<span style="color:#666"> </span>pm2<span style="color:#666">
</span><span style="color:#666">  </span>shell:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;npm install -g pm2&#34;</span><span style="color:#666">
</span><span style="color:#666">  </span>when:<span style="color:#666"> </span>not<span style="color:#666"> </span>pm2.stat.exists</code></pre></div>
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 5</span>:
  .packer/ansible/roles/pm2/tasks/main.yml
</div></li>
</ol>


<div class="notices tip" ><p><strong>Every role has checks to make sure the tasks are idempotent, this
means we can run the playbook as many times as we want and we will get the same result.</strong></p>
</div>


<h2 id="inventory">Inventory</h2>

<p>The inventory created is for a <code>packer</code> environment, that&rsquo;s why the
ansible host points to localhost.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---<span style="color:#666">
</span><span style="color:#666"></span>all:<span style="color:#666">
</span><span style="color:#666">  </span>hosts:<span style="color:#666">
</span><span style="color:#666">    </span>api:<span style="color:#666">
</span><span style="color:#666">      </span>ansible_host:<span style="color:#666"> </span><span style="color:#ed9d13">&#34;127.0.0.1&#34;</span></code></pre></div>
<div class="src-block-caption">
  <span class="src-block-number">Code Snippet 6</span>:
  .packer/ansible/env/packer/hosts.yml
</div>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="../../provision/os/" title="Operating System"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../../provision/vm/" title="Creation of VM" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../../js/clipboard.min.js?1575912935"></script>
    <script src="../../js/perfect-scrollbar.min.js?1575912935"></script>
    <script src="../../js/perfect-scrollbar.jquery.min.js?1575912935"></script>
    <script src="../../js/jquery.sticky.js?1575912935"></script>
    <script src="../../js/featherlight.min.js?1575912935"></script>
    <script src="../../js/highlight.pack.js?1575912935"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../js/modernizr.custom-3.6.0.js?1575912935"></script>
    <script src="../../js/learn.js?1575912935"></script>
    <script src="../../js/hugo-learn.js?1575912935"></script>

    <link href="../../mermaid/mermaid.css?1575912935" rel="stylesheet" />
    <script src="../../mermaid/mermaid.js?1575912935"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script src="../../js/asciinema-player.js"></script>


  </body>
</html>

